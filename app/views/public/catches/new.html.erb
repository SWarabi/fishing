<main>
<div class='container'>
  <div class=“row”>
    <div class='mx-auto col-lg-12'>
      <h1>釣果投稿</h1>
      <%= form_with model: @catch, url:'/public/catches' do |f| %>
      <%= f.hidden_field :user_id, :value => current_user.id %>
      <p>
        釣果
        <%= f.text_field :fish %><br>
      </p>
      <p>
        <%= f.file_field :image, accept: "image/*" %><br>
      </p>
      <p>
        道具
        <%= f.text_field :gear %><br>
      </p>
      <p>
        場所
        <%= f.text_field :point %><br>
      </p>
      <p>
        日にち
        <%= f.date_field :day %><br>
      </p>
      <p>
        時間
        <%= f.time_field :time %><br>
      </p>
      <p>
        その他<br>
        <%= f.text_area :comment %>
      </p>
      <!-- 追加部分 -->
      <h3>釣行場所</h3>
      <%= f.label :address, '場所' %>
      <p><%= f.text_field :address, class: 'form-control' %></p>
      <div class="map">
        <!-- 地名入力用のinputを追加 -->
        <input id="address" type="textbox" value="東京">
        <!-- buttonをクリックしたらcodeAddressを実行　-->
        <input type="button" value="検索" onclick="codeAddress()">
        <div id="map" style='width:800px; height:600px;'>
        </div>
      </div>
      <%= f.submit '投稿' %>
      <% end %>
    </die>
  </die>
</die>
</main>

<script >
let map
let geocoder

function initMap(){
  // geocoderを初期化
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
  center: {lat: 35.681236, lng: 139.767125 },
  zoom: 15
  });
}
      
      function codeAddress(){
        // 入力を取得
        let inputAddress = document.getElementById('address').value;
        // geocodingしたあとmapを移動
        geocoder.geocode( { 'address': inputAddress}, function(results, status) {
          if (status == 'OK') {
            // map.setCenterで地図が移動
            map.setCenter(results[0].geometry.location);
            // google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
            var marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location
            });
            let address = results[0].formatted_address.split(' ')
            console.log(address[1]);
            $('#catch_address').val(address[1])
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}
      
  </script>
  
  <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY'] %>&callback=initMap" async defer></script>
  

<%= render "public/footers/footer" %>

  <!--<input id="address" type="textbox" value="">-->
  <!--<input type="button" value="地図を検索" onclick="codeAddress()">-->
  <!--<div id="display">-->